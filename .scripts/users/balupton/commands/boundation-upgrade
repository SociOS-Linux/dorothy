#!/usr/bin/env bash
source "$HOME/.scripts/sources/essentials.sh"
source "$HOME/.scripts/sources/extras.sh"
source "$HOME/.scripts/sources/strict.bash"

# run boundation
secret env GITHUB_CLIENT_ID GITHUB_CLIENT_SECRET NPM_AUTHTOKEN TRAVIS_NOTIFICATION_EMAIL SURGE_LOGIN SURGE_TOKEN NOW_TOKEN -- boundation

# commit
git add .
git commit -am "updated base files and editions using boundation"

# update version
v="$(npm version minor --git-tag-version=false)"
d="$(date +"%Y %B %-d")"
t="$(tail -n +3 HISTORY.md)"
echo "# History

## $v $d

-   Updated [base files](https://github.com/bevry/base) and [editions](https://editions.bevry.me) using [boundation](https://github.com/bevry/boundation)

$t" > HISTORY.md

# output
less < HISTORY.md

# prepare
npm i
secret env GITHUB_CLIENT_ID GITHUB_CLIENT_SECRET -- npm run our:release:prepare

# release
git commit -am "$v - changelog and version bump"
secret env GITHUB_CLIENT_ID GITHUB_CLIENT_SECRET -- npm run our:release
