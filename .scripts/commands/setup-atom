#!/usr/bin/env bash
set -e

# Check
if ! command_exists apm; then
	stderr echo ''
	stderr echo 'Atom (apm) does not seem to be installed...'
	exit
fi

# User
source "$HOME/.scripts/sources/user.sh"

# Mode
if test "$1" = "update"; then
	mode="update"
else
	mode="install"
fi

# Correct settings
echo ''
echo 'Symlinking Atom settings...'
SOURCE="$HOME/.scripts/users/$(whoami)/atom"
TARGET="$HOME/.atom"
lnensure "$SOURCE/config.cson" "$TARGET/config.cson"
lnensure "$SOURCE/styles.less" "$TARGET/styles.less"
echo '...success'

# Update
echo 'Updating existing Atom plugins...'
apm update --no-confirm
echo '...success'

# Install
if test -n "$ATOM_INSTALL" -a "$mode" = "install"; then
	echo ''
	echo 'Installing Atom plugins...'
	apm install "${ATOM_INSTALL[@]}"
	echo '...success'
fi