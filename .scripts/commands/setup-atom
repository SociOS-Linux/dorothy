#!/usr/bin/env bash
set -e

# Check
if ! command_exists apm; then
	echo -e "\nAtom (apm) does not seem to be installed..."
	exit
fi

# User
source "$HOME/.scripts/sources/user.sh"

# Mode
if test "$1" = "update"; then
	mode="update"
else
	mode="install"
fi

# Correct settings
echo -e "\nSymlinking settings..."
S="$HOME/.scripts/users/$(whoami)/atom"
T="$HOME/.atom"
lnsafe "$S/config.cson" "$T/config.cson"
lnsafe "$S/styles.less" "$T/styles.less"

# Update
echo -e "\nUpdating existing Atom plugins..."
apm update --no-confirm

# Install
if test -n "$ATOM_INSTALL" -a "$mode" = "install"; then
		echo -e "\nInstalling Atom plugins..."
		# shellcheck disable=SC2086
		apm install $ATOM_INSTALL
	fi
fi